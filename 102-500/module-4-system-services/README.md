# Module 4: System Services

## Chapter 9: System Time

> **108.1: Maintain system time v2**
>
> Weight: 3

<details>

<summary>Key terms</summary>

`/etc/chrony.conf` The configuration file that controls chronyd

`/etc/ntp.conf` The configuration file for setting up the ntpd daemon as either an NTP client or server. The NTP package provides a default configuration which makes the system behave as a NTP client.

`chronyc`  the chronyc program is used to interface with chronyd via the command line

`hwclock` Command used by the root user to update and query the hardware clock

`ntpd` The NTP daemon that sets and updates the system time in synchronization with one or more reference time servers. This daemon sends messages to and receives messages from preconfigured servers at certain intervals.

`pool.ntp.org` The pool.ntp.org domain is a virtual cluster of time servers providing NTP service to system across the globe. The default entries in the `/etc/ntp.conf` file refer to a set of servers which are randomly updated every hour.

`timedatectl` System using systemd as their init-system use the timedatectl command to view and control time on the system. Running the timedatectl command without any arguments shows the current time and the time settings for the system

</details>

## Introduction

Managing system services is one of the primary job functions of a system administrator. There are a large number of services that a system can be configured to provide, including web services, file-sharing services, and authentication services.

This module will focus on four major services:

* System time: maintains accurate time used by system services and events
* Logging: records errors, warnings, and messages generated by the kernel and programs.
* Email: enables system users to send and receive email.
* Printer: manages the queing, tracking and filtering of user print jobs.

Almost every activity on the server needs to be aware of the system time.

## Understanding the Clock

Linux-based systems have two types of clocks:

* **System Clock**: This is a clock maintained by the kernel and is _interrupt-driven_. **The value of this clock is initialized from the hardware clock at boot time**. The system time is calculated as the number of seconds since `January 1st 1970 00:00:00` (This reference time is known as <mark style="color:orange;">**epoch**</mark> time or sometimes UNIX time). The system clock contains the current time as well as time zone information.
* **Hardware** **Clock**: This is a **battery-powered clock that keeps time even when the system is shut down**. When the system boots, the system clock is set using the hardware clock. When the system is shut down, the hardware clock is set to the value of the system clock. This ensures that both the clocks are synchronized. The hardware clock is also knows as the _**real time clock (RTC)**_ or the CMOS/BIOS clock.

## Maintaining the Hardware clock

The <mark style="color:red;">`hwclock`</mark> (hardware clock) command is used by the root user to **update and query the hardware clock**. The command accesses the hardware clock by performing Input/Output(I/O) via the `/dev/rtc` device file.&#x20;

To view the time of the hardware clock, execute the following command as root:

```bash
root@localhost:~  hwclock                                                    
2019-11-21 02:18:18.577020+0000
```

To **set the value of the hardware clock**, execute the following command as root:

```bash
root@localhost:~ hwclock --set --date "1/1/2025 18:30:50"                      
root@localhost:~ hwclock                                                    
2025-01-01 18:30:50.045616+0000
```

The primary purpose of the **hardware clock is to maintain the time on the computer** **while the system is powered off**, and its really the system clock that is used by the kernel and most applications in Linux.

An administrator should view the values of both clocks prior to determining which way to perform the sync. To **view the system clock, use the **<mark style="color:red;">**`date`**</mark>** command**. To view both clocks at the same time, separate the commands with a semicolon:

```bash
root@localhost:~ hwclock -r; date                                              
Wed Jan  1 18:33:34 2025  -1.065081 seconds                                     
Tue Dec 17 17:23:35 UTC 2024
```

To **set the hardware clock from the current system time**, execute either of the following commands:

```bash
root@localhost:~ hwclock -w
root@localhost:~ hwclock --systohc
```

To **set the system time from the hardware clock**, execute either of the following commands:

```bash
root@localhost:~# hwclock -s
root@localhost:~# hwclock --hctosys
```

After setting the hardware or system time , the <mark style="color:red;">`hwclock`</mark> command can be used with the <mark style="color:red;">`-r`</mark> option, which reads from the hardware clock, and the <mark style="color:red;">`date`</mark> command againg to view the changes:

```
root@localhost:~# hwclock -r; date                                              
Tue Dec 17 17:25:55 2024  -1.042681 seconds                                     
Tue Dec 17 17:25:55 UTC 2024
```

To specify the UTC or local time format of the hardware clock, use the `--utc` or `--localtime` option as shown below:

```
root@localhost:~# hwclock --set --date "1/1/2025 18:30:50" --utc                
root@localhost:~# hwclock --set --date "1/1/2025 18:30:50" --localtime          
root@localhost:~# hwclock                                                       
Wed Jan  1 18:30:54 2025  -1.059914 seconds
```

If neither of the option is specified, then the setting which was used during the last execution of the <mark style="color:red;">`hwclock`</mark> command is used. **This information is saved in the `/etc/adjtime` file** and referenced during subsequent executions of the <mark style="color:red;">`hwclock`</mark> command. When the <mark style="color:red;">`hwclock`</mark> command is used to update the system clock, it refers to the `/etc/localtime` file to retrieve time zone details.

{% hint style="info" %}
The <mark style="color:red;">`hwclock`</mark> command maintains the `/etc/adjtime` file for **storing information about the past clock values.** This file is created the first time the hardware clock is set, and each time the hardware clock is adjusted, the timestamp is written in this file.&#x20;

If you issue the <mark style="color:red;">`hwclock --adjust`</mark> command, it will add 1 second to the hardware clock per day since the last time the hardware clock was adjusted.
{% endhint %}

## Maintaining the System Clock

The <mark style="color:red;">`date`</mark> command is used to display and set the sytem date and time. To view the current date and time, execute the following command:

```
root@localhost:~# date                                                          
Tue Dec 17 18:50:20 UTC 2024
```

The system date can be displayed in different formats to suit a user 's need. For example to display only the month , day and year, execute the following:

```
root@localhost:~# date "+%m/%d/%y"                                              
12/17/24
```

The following table list the common format options that the <mark style="color:red;">`date`</mark> command supports:

| Specifier | Meaning                       |
| --------- | ----------------------------- |
| `%d`      | Day of month (e.g., `30`)     |
| `%H`      | Hour (`0-23`)                 |
| `%I`      | Hour (`1-12`)                 |
| `%m`      | Month (`1-12`)                |
| `%M`      | Minute (`0-59`)               |
| `%S`      | Seconds (`0-60`)              |
| `%T`      | Time (`%H:%M:%S`)             |
| `%u`      | Day of week (`1-7, 1=`Monday) |
| `%Y`      | Year                          |
| `%F`      | Full date; same as `%Y-%m-%d` |

In addtion to displaying and setting the date, the <mark style="color:red;">`date`</mark> command is regularly used in scripts for assigning filenames with timestamps suffixed to them.&#x20;

For example, to create separate log files for each day by moving the old log file to a new name with the current date appended, execute the following:

```bash
root@localhost:~ mv app_log app_log_`date +%F`                             
root@localhost:~ ls app*                                                   
app_log_2025-12-17
```

To change the system date, execute the following command as the root user

```bash
root@localhost:~ date -s "01/02/2028 12:00:00"
```

{% hint style="info" %}
The <mark style="color:red;">`date`</mark> command should not be used to attempt to update the system clock if the NTP service, which syncs the software clock with internet time servers, has been set up on the server.&#x20;
{% endhint %}

## Displaying and Setting the Time Zone

There are two files that manage the time zone, depending on the distribution being used.

#### The `/etc/localtime` File

On some distributions (i.e CentOS), the `/etc/localtime` file is used to configure the time zone of the system. The time zone data for different regions is maintained in the `/usr/share/zoneinfo` directory. To set up a particular time zone, a symbolic link is created from the `/etc/localtime` file to the corresponding file in the `/usr/share/zoneinfo` directory.

To view the contents of the `/usr/share/zoneinfo` directory, execute the following

```bash
root@localhost:~ ls /usr/share/zoneinfo                                        
Africa      Cuba     GMT+0      Kwajalein  Poland     WET                       
America     EET      GMT-0      Libya      Portugal   Zulu                      
Antarctica  EST      GMT0       MET        ROC        iso3166.tab               
Arctic      EST5EDT  Greenwich  MST        ROK        leap-seconds.list         
Asia        Egypt    HST        MST7MDT    Singapore  localtime                 
Atlantic    Eire     Hongkong   Mexico     SystemV    posix                     
Australia   Etc      Iceland    NZ         Turkey     posixrules                
Brazil      Europe   Indian     NZ-CHAT    UCT        right         
```

To view the details of a particular zone, view the subdirectory with the `ls` command as follows:

```
root@localhost:~# ls /usr/share/zoneinfo/Australia                              
ACT          Canberra  Hobart     Melbourne  Queensland  Victoria               
Adelaide     Currie    LHI        NSW        South       West                   
Brisbane     Darwin    Lindeman   North      Sydney      Yancowinna             
Broken_Hill  Eucla     Lord_Howe  Perth      Tasmania
```

To set the time zone to the America TIjuana time zone (PST), execute the following link `ln` command as the root user , then verify the change with `date`:

```bash
root@localhost:~:~# date                                                          
Tue Dec 17 21:00:59 UTC 2024                                                    
root@localhost:~ ln -sf /usr/share/zoneinfo/America/Tijuana /etc/localtime     
root@localhost:~ date                                                          
Tue Dec 17 13:01:32 PST 2024
```

#### The `/etc/timezone` File

On Debian-based systems there is secondary file `/etc/timezone` :

```bash
root@localhost:~ cat /etc/timezone
Etc/UTC
```

This can be changed by using a text editor to edit the `/etc/timezone` file to include the same time zone , relative to the `/usr/share/zoneinfo` directory, that was used to link to the `/etc/localtime` file.

```
root@localhost:~# vi /etc/timezone
America/Tijuana
~
~
~
“/etc/timezone” 1 line, 16 characters
```

{% hint style="info" %}
Users can override the system's time zone by using the `TZ` environment variable. For example, if the client application running in Singapore needs to sync the databse instance running on a server in Amercia, the user can change the time zone using the `TZ` enviroment variable to ensure that both applications run in the same time zone:

```
root@localhost:~# export TZ=America/New_York
```
{% endhint %}

## Network Time Protocol

The Network Time Protocol (NTP) is the most used method for synchronizing the local server's system time with the time provided by designated local or internet-based time severs.

{% hint style="info" %}
The reference time used by NTP is UTC. The NTP software will convert this to the appropiate time zone for any given system.
{% endhint %}

The NTP package contains the NTP daemon and some additional programs to configure the service and query the time servers.

### Understanding ntpd

The NTP daemon, <mark style="color:red;">`ntpd`</mark> ,**sets and updates the system time in synchronization with one or more reference time servers**. This daemon sends messages to and receives messages from preconfigured servers at certain intervals. The <mark style="color:red;">`ntpd`</mark> daemon **can also be configured to act as a server,** so other clients may query this server to synchronize their system time.

> It can also read data from external hardware resources such as GPS receivers.

The following table lists some of the key options of the `ntpd` daemon:

| Option         | Meaning                                                                                                   |
| -------------- | --------------------------------------------------------------------------------------------------------- |
| `-g`           | Allow `ntpd` to be started on a system whose clock has crossed the panic threshold (1000 secs by default) |
| `-n`           | Do not run `ntpd` as a daemon (i.e., run it as a foreground process)                                      |
| `-c file_name` | Use the specified file for configuration instead of the default file (the `/etc/ntp.conf` file)           |
| `-N`           | Run at the highest possible priority                                                                      |
| `-q`           | Quit after setting the time (i.e., one-time synchronization)                                              |

### `/etc/ntp.conf` File

The `/etc/ntp.conf` file is the **configuration file for setting up the **<mark style="color:red;">**`ntpd`**</mark>** daemon** as either an NTP client or server. The NTP package provides a default configuration, which makes the system behave as an NTP client.&#x20;

> If the system has access to the internet, this file should be configured automatically to use 3 NTP servers from the ntp.org domain

A sample `/etc/ntp.conf` file looks like the following:

```
#List of public NTP servers to be queried
server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst
 
restrict default ignore 
 
restrict 127.0.0.1
 
driftfile /var/lib/ntp/ntp.drift
logfile /var/log/ntpser.log
```

The fields for this file are described below:

#### Server

```
server 0.pool.ntp.org iburst
```

The server lines **indicates the NTP servers to synchronize with**. The server keyword indicates an association between the client and the specified remote server so that the local clock can be synchronized to the server. The **`iburst`** mode indicates that if the server is unreachable, then send a burst of eight requests instead of the usual one. It also serves to speed up the initial synchronization.

{% hint style="info" %}
If more than one server is specified, then all servers will be queried, and the time that is returned by the majority of the servers will be used.&#x20;
{% endhint %}

#### Restrict

```
restrict default ignore
```

The first restrict line is **used to restrict access to other computers**. This means that this computer will not act as an NTP servers for other machines. Oddly enough, this also prevents your own system from getting date/time information from the <mark style="color:red;">`ntpd`</mark> <mark style="color:red;"></mark><mark style="color:red;"></mark> daemon, which is the purpose of the next line.

```
restrict 127.0.0.1
```

The second restrict line indicates that the localhost (127.0.0.1) will be able to monitor the `ntpd`daemon.

#### Driftfile

```
driftfile /var/lib/ntp/ntp.drift
```

The driftfile setting indicates the file that is **used to store the drift time** . This file **contains a value that is an average over time of how much the local time "drifts" from the NTP server time**. Over time, this file is consulted by the `ntpd` daemon to allow it to adjust the local time without having to contact the NTP servers as frequently.

#### Logfile

```
logfile /var/log/ntpser.log
```

The logfile setting indicates the **location where the NTP log file is stored**. For occasions when NTP errors occur, it is possible to find the cause by looking at the log file.

{% hint style="info" %}
If the system is to be configured as an NTP server, then add a server line that has the current machine's IP address and add the following restrict line:

```
server 127.127.1.0
restrict default nomodify nopeer noquery
```

This will allow  the server to service incoming time requests. The options of `nomodify`, `nopeer`, `noquery` make the NTP server more secure.

After saving the `/etc/ntp.conf` file, restart the `ntpd` daemon by executing the following:

```
root@localhost:~# service ntpd restart
```

To set the `ntpd` daemon to start at boot time, execute the following command:

```
root@localhost:~# chkconfig ntpd on
```
{% endhint %}

### Querying NTP

The <mark style="color:red;">`ntpq`</mark> utility is used to **query NTP and monitor the performance of the **<mark style="color:red;">**`ntpd`**</mark><mark style="color:red;">** **</mark><mark style="color:red;">****</mark>** daemon**. It can be executed either in command line mode or interactive mode. To print a summary of the peers of your server, the following command can be used:

```bash
root@localhost:~ ntpq –pn
remote              refid      s  t  when  poll    reach  delay    offset    jitter
====================================================================================
‌
*ts0.example.com  194.20.10.2  1  u  648   1024    259    31.234    3.353    3.096
```

The following table explains some of the fileds in the output above:

| Field    | Example Value      | Significance                                               |
| -------- | ------------------ | ---------------------------------------------------------- |
| `remote` | `*ts0.example.com` | Refers to the server being synced                          |
| `refid`  | `194.20.10.2`      | Specifies the IP address of the server                     |
| `s`      | `1`                | Stratum, see below                                         |
| `t`      | `u`                | Refers to the type (unicast, broadcast, etc.)              |
| `when`   | `648`              | Refers to how many seconds since the last polling was done |

**An NTP **_**stratum**_** is a number that refers to how close to a reference clock the NTP server is.** A reference clock should have the most accurate possible time. A reference clock is referred to as a _Stratum-0_ clock. An NTP server that updates its time to a reference clock is referred to as a _Stratum-1_ clock.

> Hence the higher stratum number, the less likely the clock is accurate as it is furthest away from the most accurate clock.

### Tracing NTP

The <mark style="color:red;">`ntptrace`</mark> utility is **useful for debugging and provides the trace of the chain of NTP server to the source**. It traverse the path starting from the `localhost` to the time servers from which the time has been derived.

To check the trace of the current system, execute the <mark style="color:red;">`ntptrace`</mark> <mark style="color:red;"></mark><mark style="color:red;"></mark> command.

```bash
root@localhost:~ ntptrace
localhost: stratum 4, offset 0.0019529, synch distance 0.144135
server1del.com: stratum 2, offset 0.0129876, synch distance 0.102469
iitb.edu: stratum 2, offset 0.0018257, synch distance 0.011658, refid ’WWWN’
```

The important fileds in the output are the hostname, the stratum number, and the time difference in seconds between the two hosts in the path traversed.

### Setting Time using `ntpdate`

The <mark style="color:red;">**`ntpdate`**</mark> utility is **used to set the system date and time using NTP**. The functionallity of this utility is **equivalent to using the **<mark style="color:red;">**`ntpd -q`**</mark> .The <mark style="color:red;">`-q`</mark> option to the <mark style="color:red;">`ntpd`</mark> command makes the <mark style="color:red;">`ntpdate`</mark> command redundant, and as a result, the `ntpdate` command may not be supported in future releases of Linux distro

The root user can execute the <mark style="color:red;">`ntpdate`</mark> <mark style="color:red;"></mark><mark style="color:red;"></mark> command to explicity set the time if the NTP daemon is not running, or it can be executed in a startup script if there is a requirement to set the time via NTP even before the NTP daemon has started.

To verify if a specific NTP server is available, execute the <mark style="color:red;">`ntpdate`</mark> command with the query <mark style="color:red;">`-q`</mark> option.

```bash
root@localhost:~ ntpdate -q 2.asia.pool.ntp.org
server 212.26.18.41, stratum 1, offset -0.011471, delay 0.23927
server 27.114.150.12, stratum 2, offset -0.037521, delay 0.30266
server 137.189.4.10, stratum 1, offset -0.013831, delay 0.24474
server 185.23.153.237, stratum 2, offset -0.001132, delay 0.29622
11 Mar 13:22:13 ntpdate[8924]: adjust time server 212.26.18.41 offset -0.011471 sec
```

To set the date and time using an NTP server, execute the following command:

```
root@localhost:~# ntpdate 2.asia.pool.ntp.org
```

Some of the key options of the <mark style="color:red;">`ntpdate`</mark> <mark style="color:red;"></mark><mark style="color:red;"></mark> command are:

| Option               | Meaning                                                                            |
| -------------------- | ---------------------------------------------------------------------------------- |
| `-p <numof_samples>` | Number of samples to be polled from each server, valid range is `1 – 8`            |
| `-t <timeout>`       | Maximum time to wait for a response from the server should be expressed in seconds |

### Setting time using `timdatectl`

System using **`systemd`** as their init-system use the <mark style="color:red;">`timedatectl`</mark> command to **view and control time on the system**. Running the <mark style="color:red;">`timedatectl`</mark> command without any arguments shows the current time and the time settings for the system.

```
sysadmin@localhost:~$ timedatectl
               Local time: Fri 2019-10-18 07:46:03 CDT
           Universal time: Fri 2019-10-18 12:46:03 UTC
                 RTC time: Fri 2019-10-18 12:46:03
                Time zone: America/Chicago (CDT, -0500)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```

The most commonly-used arguments for the `timedatectl` command are listed below:

| Argument          | Description                                                                                                                                                                                                                                        |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `set-time`        | **Set the system clock to the specified time.** This will also update the RTC time accordingly. The time may be specified in the format: 4-Digit Year-Month-Day Hour in 24-hr format: Minutes:seconds.                                             |
| `set-timezone`    | **Set the system time zone to the specified value**. Available time zones can be listed with list-timezones. If the RTC is configured to be the local time, this will also update the RTC time. This call will alter the `/etc/localtime` symlink. |
| `list-timezones`  | List available time zones, one per line. Entries from the list can be set as the system time zone with set-timezone.                                                                                                                               |
| `timesync-status` | **Show the current status of synchronization** to the current Network Time Protocol (NTP) time source, such as the NTP server being used and the polling interval.                                                                                 |
| `set-ntp [BOOL]`  | Controls whether network time synchronization is active and enabled. Using the BOOL if true or false will enable or disable using NTP on the system.                                                                                               |

To set the time on a `systemd` enabled system , use the `set-time` command for the `timedatectl` command.

```bash
sysadmin@localhost:~$ sudo timedatectl set-time “2019-10-18 08:24:00”
[sudo] password for sysadmin:
```

If there are no problems, you will not get any output from the above command. If the system is using NTP, you will get the following error:

```bash
sysadmin@localhost:~$ sudo timedatectl set-time “2019-10-18 08:24:00”
[sudo] password for sysadmin:
Failed to set time: Automatic time synchronization is enabled
```

{% hint style="warning" %}
Dual boot systems with Linux and Windows can be off by the difference between the timezone in which they are set and UTC every time the user swithces operating systems.&#x20;

To remedy this issue, the following command can be used:

```bash
sysadmin@localhost:~$ sudo timedatectl set-local-rtc 1 --adjust-system-clockas
```
{% endhint %}

### Using `pool.ntp.org`

The <mark style="color:blue;">pool.ntp.org</mark> domain is a **virtual cluster of time servers** providing NTP service to systems across the globe.

> &#x20;The default entries in the `/etc/ntp.conf` file refer to a set of servers that are randomly updated every hour

To verify this, view the output of the <mark style="color:red;">`ntpq -pn`</mark> command now and then an hour later.

The implementation of the server pool is such that the servers close to the geographic location of the NTP client will be alocated to the `ntpd` daemon . The user also has the option to specify the preferred continent or country zone to pick up the pool from. For example, to specify the Asia servers, update the `/etc/ntp.conf` file as follows:

```
server 0.asia.pool.ntp.org
server 1.asia.pool.ntp.org
server 2.asia.pool.ntp.org
```

## Understanding `chronyd`

As an alternative to `ntpd`, <mark style="color:red;">`chrony`</mark> lends itself to **working well in envrionments with intermittent network connectivity**, such as on a laptop or virtual system that may be created through an automated process.

{% hint style="info" %}
<mark style="color:red;">`chrony`</mark> is a set of programs that are used to ensure that the clock on a system is accurate.
{% endhint %}

The daemon portion of <mark style="color:red;">`chrony`</mark> <mark style="color:red;"></mark><mark style="color:red;"></mark> is the command <mark style="color:red;">`chronyd`</mark>`.` The daemon synchronizes the system with time retrieved from NTP servers. Along with synchronizing time on the system it is running, <mark style="color:red;">`chronyd`</mark> <mark style="color:red;"></mark><mark style="color:red;"></mark> can also operates as an NTP server providing time service to other systems that are allowed network access.

To control `chronyd` ,you use the <mark style="color:red;">`chronyc`</mark> program to interface with `chronyd` via the command line. The <mark style="color:red;">`chronyc`</mark> command can be used in two different modes; _interactive and non-interactive_ mode.

> If no argument is specified on the command line, the `chronyc` command will run in interactive mode and return a `chrony>` prompt where you can then enter `chronyc` commands.

```bash
root@localhost:~# chronyc
chrony version 3.2
Copyright © 1997-2003, 2007, 2009-2017 Richard P. Curnow and others
crony comes with ABSOLUTELY  NO WARRANTY. This is free software, and you are welcome to redistribute it under certain conditions. See the GNU General Public License version 2 for details. 
 
chronyc>
```

Note that the `chronyc` command should be run as the root user since some of the `chronyc` commands may be restricted for regular users.

Common `chronyc` command are listed below:

| Argument         | Description                                                                                                                                                                                                                             |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `tracking`       | Displays **performance statistics** about the system clock                                                                                                                                                                              |
| `sources`        | Displays the **NTP sources being used** for `chronyd`                                                                                                                                                                                   |
| `activity`       | Displays the **status of NTP sources**                                                                                                                                                                                                  |
| `settime <TIME>` | <p>Allows you to manually set the time used for <code>chronyd</code>. The format for <code>settime</code> can be any of the below:</p><p><code>hh:mm</code></p><p><code>hh:mm:ss</code></p><p><code>Month Day, YYYY hh:mm:ss</code></p> |

To demonstrate, if you want to display information and performance statistics about the system clock in interactive mode, use the `tracking` command at the `chronyc>` prompt:

```bash
chronyc> tracking
Reference ID    : 6C3D49F3 (hydrogen.constant.com)
Stratum         : 3
Ref time (UTC)  : Thu Nov 07 03:10:17 2019
System time     : 0.000021801 seconds slow of NTP time
Last offset     : -0.00021801 seconds
RMS offset      : 0.000106846 seconds
Frequency       : 26.657 ppm slow
Residual freq   : -0.007 ppm
Skew            : 0.093 ppm
```

The **Ctrl+D** keys can be used to exit interactive mode.

To run `chronyc` in non-interactive mode, the following syntax can be used:

```
chronyc command
```

For example, to display a list of NTP sources being used for `chronyd` in non-interactive mode, use the following command:

```bash
root@localhost:~# chronyc sources
210 Number of sources = 4
MS Name/IP address        Stratum Poll Reach LastRx Last sample
=============================================================================
^_ au.kashra.pictures          2   6  377        4 -2991us[-2991us] +/- 125ms
^* hydrogen.constant.com       2   9  377      205  -756us[ -678us] +/-  33ms
^- lax1.justaguy.be            2   8  377       20 +1559us[+1559us] +/-  98ms
^+ li924-200.members.linode>   2  10  377      671 +1321us[+1394us] +/-  31ms
```

### `/etc/chrony.conf` File

The configuration file that controls `chronyd` is the `/etc/chrony.conf` file (on some distributions, the file path is `/etc/chrony/chrony.conf`). The `/etc/chrony.conf` file allows you to specify the NTP pool to use and what files are used for things like logging, skew rate, and if the hardware clock is using UTC.

```
# Welcome to the chrony configuration file. See chrony.conf(5) for more
# information about usable directives.
 
# This will use (up to):
# - 4 sources from ntp.ubuntu.com which some are ipv6 enabled
# - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well
# - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)
# This means by default, up to 6 dual-stack and up to 2 additional IPv4-only
# sources will be used.
# At the same time it retains some protection against one of the entries being
# down (compare to just using one of the lines). See (LP: #1754358) for the
# discussion.
#
# About using servers from the NTP Pool Project in general see (LP: #104525).
# Approved by Ubuntu Technical Board on 2011-02-08.
# See http://www.pool.ntp.org/join.html for more information.
pool ntp.ubuntu.com        iburst maxsources 4
pool 0.ubuntu.pool.ntp.org iburst maxsources 1
pool 1.ubuntu.pool.ntp.org iburst maxsources 1
pool 2.ubuntu.pool.ntp.org iburst maxsources 2
 
# This directive specify the location of the file containing ID/key pairs for
# NTP authentication.
keyfile /etc/chrony/chrony.keys
 
# This directive specify the file into which chronyd will store the rate
# information.
driftfile /var/lib/chrony/chrony.drift
 
# Uncomment the following line to turn logging on.
#log tracking measurements statistics
 
# Log files location.
logdir /var/log/chrony
 
# Stop bad estimates upsetting machine clock.
maxupdateskew 100.0
 
# This directive enables kernel synchronisation (every 11 minutes) of the
# real-time clock. Note that it can’t be used along with the 'rtcfile' directive.
rtcsync
 
# Step the system clock instead of slewing it if the adjustment is larger than
# one second, but only in the first three clock updates.
makestep 1 3
```

The `/etc/chrony.conf` file has directives listed with one on each line. These directives are summarized in the table below:

| Directive                      | Meaning                                                                                                             |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------- |
| `pool <pool address>`          | Specify address of the NTP pool to use.                                                                             |
| `logdir <location for logs>`   | Location where log files will be created.                                                                           |
| `server <server address>`      | Specify address of the NTP server to use.                                                                           |
| `allow <IP address or subnet>` | When used as an NTP server, specifies what address/subnets are allowed to access `chronyd` to synchronize time.     |
| `deny <IP or subnet>`          | When used as an NTP server, specifies what address/subnets are not allowed to access `chronyd` to synchronize time. |
